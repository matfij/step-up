# yaml-language-server: $schema=https://coderabbit.ai/integrations/schema.v2.json
language: "en-US"
early_access: true

reviews:
  profile: "assertive"
  request_changes_workflow: true
  high_level_summary: true
  review_status: true
  review_details: true
  collapse_walkthrough: true

  pre_merge_checks:
    docstrings:
      mode: "off"

  auto_review:
    enabled: true
    drafts: false
    base_branches: ["main", "develop"]

  path_instructions:
    - path: "apps/server/**/*.cs"
      instructions: |
        This is .NET 10.0 Minimal API code following Domain-Driven Design patterns.
        - Enforce Domain-Driven Design structure: Entity → Repository → Service (with optional Validator) → Endpoints
        - Services must depend on Repository, concentrate logic and react to events
        - All layers must be loosely coupled based on Interfaces
        - Validators must separate async DB checks from sync business rules
        - Ensure proper domain event publishing after state changes
        - Flag tight coupling between layers (e.g., endpoints directly using repositories)
        - Promote Locality of Behavior, simple abstractions and uni-directional data flow
        - Verify all Repositories and Services are registered in Program.cs
        - Verify all Endpoints are mapped in Program.cs
        - Event handlers must be registered as IEventHandler<TEvent> in Program.cs
        - Protected endpoints must use .WithMetadata(new RequireAuthAttribute())
        - Ensure RESTful conventions (GET/POST/PUT/DELETE with appropriate HTTP verbs)
        - Throw ApiException with translation keys (e.g., "errors.userNotFound")
        - Ensure proper validation in Validators (or Services if validation is simple) before DB operations
        - Ensure all API responses are mapped in Endpoints
        - Check that cancellation tokens are passed to async methods where appropriate
        - Verify proper null handling with nullable reference types
        - MongoDB Client should be Singleton, Database should be Singleton, Repositories/Services should be Scoped
        - Repository constructors must receive IMongoDatabase via DI
        - Indexes should be created in repository constructors
        - Timestamps must be ulong (Unix timestamp milliseconds)
        - Entity IDs must be string type
        - Use primary constructors for DI (C# 12)
        - Use required keyword for required properties in DTOs/records
        - Prefer record for DTOs and domain events
        - Use init for immutable properties
        - Verify nullable reference types are properly annotated
        - Ensure async methods return Task or Task<T>
        - Verify API token authentication via Authorization header
        - Check that protected endpoints enforce RequireAuthAttribute
        - Ensure sensitive data is not exposed in error messages
        - Flag hardcoded secrets or connection strings

    - path: "apps/mobile/src/**/*.{ts,tsx}"
      instructions: |
        This is React Native (Expo SDK 54) code with TypeScript strict mode.
        - Enforce proper React hooks usage (no conditional hooks, correct dependency arrays)
        - Heavy logic must be in custom hooks or services, not inside components
        - Flag inline object/function creation in JSX that causes unnecessary re-renders
        - useCallback/useMemo should be used appropriately for performance
        - Verify proper cleanup in useEffect hooks
        - Check for missing dependencies in useEffect/useCallback/useMemo
        - Store files must be in common/state/ with -store suffix
        - Verify AsyncStorage persistence configuration
        - Store keys must be prefixed with app identifier
        - Check for proper TypeScript typing of store state and actions
        - Ensure stores are not directly mutated (use Zustand patterns)
        - API calls must be abstracted in common/api/ client classes
        - Clients must extend ApiClient base class
        - API hooks should be in api-hooks.ts following React hooks pattern
        - Verify proper error handling with ApiError class
        - Check for proper loading and error states in components
        - Ensure Authorization header uses token from user store
        - Verify file-based routing conventions (routes in src/app/)
        - Protected routes must use Stack.Protected with guard prop
        - Check proper typing of route params and navigation props
        - Tab routes should be in (tabs)/ directory
        - Verify proper use of useRouter, useLocalSearchParams, useSegments
        - Styles must use theme from common/theme.ts (no hardcoded colors/spacing)
        - Use StyleSheet.create() for styles
        - Common components must use App* prefix (e.g., AppButton, AppInput)
        - Verify support for disabled/pressed states in interactive components
        - Check for duplicated style definitions that should be reusable
        - Ensure theme values are used (colors, spacing, borderRadius, opacity)
        - Translation keys must use dot notation (e.g., errors.unknown)
        - Verify useTranslation() hook is used, not direct t() calls
        - Check that translation keys exist in en.json
        - Flag hardcoded user-facing strings
        - Enforce TypeScript strict mode compliance
        - API types must be defined in common/api/api-definitions.ts
        - Use TypeScript interfaces for data structures
        - Verify proper typing of props, state, and function parameters
        - Flag `any` usage (should be typed properly), confirm unknown usage (if it was intended)
        - Check for proper null/undefined handling
        - Flag heavy computations in render (should use useMemo)
        - Check for proper list rendering (FlatList vs map, proper keyExtractor)
        - Verify proper handling of async operations
        - Ensure images use proper source types (static vs uri)
        - Check for memory leaks (unsubscribed listeners, timers)
        - Background location tracking must use expo-location + expo-task-manager
        - Route data should be stored as lat/lng arrays
        - Activity state must use custom hooks (use-activity.ts)
        - Verify proper permission handling for location services
        - Check for proper error state display in UI
        - Ensure user-facing error messages are translated
        - Ensure no feature-specific code leaks into common/
        - Components must be truly reusable (no feature coupling)
        - Utilities should be pure functions where possible
        - Theme must be the single source of truth for styling values
        - Config values must be defined as const in config.ts

  finishing_touches:
    docstrings:
      enabled: false

  tools:
    markdownlint:
      enabled: true

    languagetool:
      enabled: true
      level: "picky"

    shellcheck:
      enabled: true

    yamllint:
      enabled: true

    hadolint:
      enabled: true

    eslint:
      enabled: true

    biome:
      enabled: true

chat:
  auto_reply: true
